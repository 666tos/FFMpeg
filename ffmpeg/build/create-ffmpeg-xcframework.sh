#!/bin/sh

CURRENT_FOLDER=`pwd`
FRAMEWORK_NAME="FFmpeg"

FRAMEWORK_EXT=".framework"
FRAMEWORK="$FRAMEWORK_NAME$FRAMEWORK_EXT"

XCFRAMEWORK_EXT=".xcframework"
XCFRAMEWORK="$FRAMEWORK_NAME$XCFRAMEWORK_EXT"

LIB_EXT=".a"
LIBRARY="$FRAMEWORK_NAME$LIB_EXT"

BUILD_FOLDER_IOS="$CURRENT_FOLDER/FFmpeg-iOS"
BUILD_FOLDER_MACOS="$CURRENT_FOLDER/FFmpeg-OSX"
BUILD_FOLDER_TVOS="$CURRENT_FOLDER/FFmpeg-tvOS"
BUILD_FOLDER_MACCATALYST="$CURRENT_FOLDER/FFmpeg-maccatalyst"
OUTPUT_FOLDER="$CURRENT_FOLDER/$FRAMEWORK"

XCODE_PATH=$(xcode-select -p)

rm -rf $XCFRAMEWORK

xcodebuild -create-xcframework \
	-library "$BUILD_FOLDER_IOS/tmp/$FRAMEWORK_NAME-arm64$LIB_EXT"\
	-headers "$BUILD_FOLDER_IOS/include/" \
	-library "$BUILD_FOLDER_IOS/tmp/$FRAMEWORK_NAME-x86_64$LIB_EXT"\
	-headers "$BUILD_FOLDER_IOS/include/" \
	-library "$BUILD_FOLDER_MACCATALYST/tmp/$LIBRARY"\
	-headers "$BUILD_FOLDER_MACCATALYST/include/" \
	-output "$XCFRAMEWORK"

